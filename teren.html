<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fi»ôƒÉ Teren</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
</head>
<body>
  <header><h1>Mod Teren</h1></header>
  <nav>
    <a href="index.html">AcasƒÉ</a>
    <a href="birou.html">Birou</a>
  </nav>

  <div class="container">
    <h2>Observa»õii pe teren</h2>

    <label>Specie:</label>
    <input type="text" id="specieTeren"><br><br>

    <label>Diametru (cm):</label>
    <input type="number" id="diametru"><br><br>

    <label>√énƒÉl»õime (m):</label>
    <input type="number" id="inaltime"><br><br>

    <label>Observa»õii:</label><br>
    <textarea id="observatii" rows="4" cols="40"></textarea><br><br>

    <button onclick="getLocation()">üìç Preia loca»õia</button>
    <p id="locatie"></p>

    <input type="file" accept="image/*" capture="environment"><br><br>

    <button onclick="salveaza()">üíæ SalveazƒÉ</button>
    <button onclick="exportPDF()">üßæ Export PDF</button>
    <button onclick="exportExcel()">üìä Export Excel</button>
  </div>

  <script>
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          const lat = pos.coords.latitude.toFixed(5);
          const lon = pos.coords.longitude.toFixed(5);
          document.getElementById("locatie").textContent = `Lat: ${lat}, Lon: ${lon}`;
        }, err => {
          document.getElementById("locatie").textContent = "Loca»õie indisponibilƒÉ.";
        });
      } else {
        document.getElementById("locatie").textContent = "Geolocalizare neacceptatƒÉ.";
      }
    }

    function salveaza() {
      const specie = document.getElementById("specieTeren").value;
      const diametru = document.getElementById("diametru").value;
      const inaltime = document.getElementById("inaltime").value;
      const observatii = document.getElementById("observatii").value;
      const locatie = document.getElementById("locatie").textContent;

      const date = { specie, diametru, inaltime, observatii, locatie };
      console.log("üìã Date salvate:", date);
      alert("Datele au fost salvate local (simulat).");
    }

    function loadScriptOnce(scriptUrl) {
      return new Promise((resolve, reject) => {
        if (document.querySelector(`script[src="${scriptUrl}"]`)) { resolve(); return; }
        const s = document.createElement('script');
        s.src = scriptUrl;
        s.async = true;
        s.onload = () => resolve();
        s.onerror = () => reject(new Error(`Eroare la √ÆncƒÉrcarea scriptului: ${scriptUrl}`));
        document.head.appendChild(s);
      });
    }

    async function exportPDF() {
      const jspdfUrl = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
      if (!window.jspdf) {
        await loadScriptOnce(jspdfUrl);
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const specie = document.getElementById("specieTeren").value;
      const diametru = document.getElementById("diametru").value;
      const inaltime = document.getElementById("inaltime").value;
      const observatii = document.getElementById("observatii").value;
      const locatie = document.getElementById("locatie").textContent;

      doc.text("Fi»ôƒÉ Teren - Arboret", 10, 10);
      doc.text(`Specie: ${specie}`, 10, 20);
      doc.text(`Diametru: ${diametru} cm`, 10, 30);
      doc.text(`√énƒÉl»õime: ${inaltime} m`, 10, 40);
      doc.text(`Observa»õii: ${observatii}`, 10, 50);
      doc.text(`Loca»õie: ${locatie}`, 10, 60);

      doc.save("fisa_teren.pdf");
    }

    async function exportExcel() {
      const xlsxUrl = 'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
      if (!window.XLSX) {
        await loadScriptOnce(xlsxUrl);
      }

      const specie = document.getElementById("specieTeren").value;
      const diametru = document.getElementById("diametru").value;
      const inaltime = document.getElementById("inaltime").value;
      const observatii = document.getElementById("observatii").value;
      const locatie = document.getElementById("locatie").textContent;

      const ws_data = [
        ["Specie", "Diametru (cm)", "√énƒÉl»õime (m)", "Observa»õii", "Loca»õie"],
        [specie, diametru, inaltime, observatii, locatie]
      ];

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(ws_data);
      XLSX.utils.book_append_sheet(wb, ws, "FisaTeren");
      XLSX.writeFile(wb, "fisa_teren.xlsx");
    }
  </script>
</body>
</html>